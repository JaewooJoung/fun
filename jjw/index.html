<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Analysis Report: $ticker</title>
    $css
</head>
<body>
    <h1>Stock Analysis Report: $ticker</h1>
    <p>Report generated on $current_datetime</p>
    
    <div class="container">
        <h2>Stock Analysis Summary</h2>
        <div class="summary-text">$summary_display_text</div>
    </div>
    
    <div class="container">
        <h2>Current Strategy: <span class="$strategy_class">$strategy_text</span></h2>
        
        <div class="metrics">
            <div class="metric-card">
                <div class="metric-title">Current Price</div>
                <div class="metric-value">$(get(analysis_data, "current_price", "N/A"))</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">RSI(14)</div>
                <div class="metric-value">$(get(analysis_data, "rsi", "N/A"))</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">MACD</div>
                <div class="metric-value">$(get(analysis_data, "macd", "N/A"))</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">P/E Ratio</div>
                <div class="metric-value">$(get(analysis_data, "pe_ratio", "N/A"))</div>
            </div>
        </div>
        
        <h3>Signals (Last 30 Days)</h3>
        <table>
            <tr>
                <th>Signal Type</th>
                <th>Count</th>
            </tr>
            <tr>
                <td>Buy Signals</td>
                <td>$(get(analysis_data, "buy_signals", 0))</td>
            </tr>
            <tr>
                <td>Sell Signals</td>
                <td>$(get(analysis_data, "sell_signals", 0))</td>
            </tr>
        </table>
    </div>
    
    <!-- Combined Analysis Chart -->
    <div class="container">
        <h2>Combined Technical Analysis</h2>
        <img class="chart" src="$(chart_paths["combined"])" alt="Combined Technical Analysis Chart">
    </div>
    
    <!-- Price Chart with Buy/Sell Signals -->
    <div class="container">
        <h2>Price Movement and Signals</h2>
        <div class="chart-container">
            <div class="chart-title">Price Chart with Buy/Sell Signals</div>
            <img class="chart" src="$(chart_paths["price"])" alt="Price Chart with Buy/Sell Signals">
            <div class="chart-description">
                The price chart shows the stock's price movement over time with buy signals (green circles) and 
                sell signals (red crosses). Moving averages help identify the overall trend.
            </div>
        </div>
    </div>
    
    <!-- Technical Indicators -->
    <div class="container">
        <h2>Technical Indicators</h2>
        
        <!-- RSI Chart -->
        <div class="chart-container">
            <div class="chart-title">Relative Strength Index (RSI)</div>
            <img class="chart" src="$(chart_paths["rsi"])" alt="RSI Chart">
            <div class="chart-description">
                RSI measures the speed and change of price movements. Values above 70 indicate overbought conditions
                (potential sell signal), while values below 30 indicate oversold conditions (potential buy signal).
            </div>
        </div>
        
        <!-- MACD Chart -->
        <div class="chart-container">
            <div class="chart-title">Moving Average Convergence Divergence (MACD)</div>
            <img class="chart" src="$(chart_paths["macd"])" alt="MACD Chart">
            <div class="chart-description">
                MACD shows the relationship between two moving averages of a security's price. 
                The MACD line crossing above the signal line is bullish, while crossing below is bearish.
                The histogram shows the difference between MACD and signal line.
            </div>
        </div>
        
        <!-- Bollinger Bands Chart -->
        <div class="chart-container">
            <div class="chart-title">Bollinger Bands</div>
            <img class="chart" src="$(chart_paths["bollinger"])" alt="Bollinger Bands Chart">
            <div class="chart-description">
                Bollinger Bands consist of a middle band (20-day SMA) with an upper and lower band.
                Price reaching the upper band may indicate overbought conditions, while reaching the lower band may indicate
                oversold conditions. The width of the bands indicates volatility.
            </div>
        </div>
    </div>
    
    <!-- Advanced Technical Analysis -->
    <div class="container">
        <h2>Advanced Technical Analysis</h2>
        
        <!-- Fibonacci Retracement Chart -->
        <div class="chart-container">
            <div class="chart-title">Fibonacci Retracement</div>
            <img class="chart" src="$(chart_paths["fibonacci"])" alt="Fibonacci Retracement Chart">
            <div class="chart-description">
                Fibonacci retracement levels (23.6%, 38.2%, 50%, 61.8%, etc.) are horizontal lines that indicate where 
                support and resistance are likely to occur based on Fibonacci numbers. These are important levels
                where price might reverse direction.
            </div>
        </div>
        
        <!-- ATR Chart (replaced All-Time Highs) -->
        <div class="chart-container">
            <div class="chart-title">Average True Range (ATR)</div>
            <img class="chart" src="$(chart_paths["atr"])" alt="ATR Chart">
            <div class="chart-description">
                ATR measures the volatility of a stock by calculating the average of true ranges over a given period.
                Higher ATR values indicate higher volatility, while lower values suggest consolidation. This helps
                in setting stop-losses and determining position sizes.
            </div>
        </div>
        
        <!-- Golden/Death Cross Chart -->
        <div class="chart-container">
            <div class="chart-title">Moving Average Crosses (Golden Cross & Death Cross)</div>
            <img class="chart" src="$(chart_paths["crosses"])" alt="Moving Average Crosses Chart">
            <div class="chart-description">
                A Golden Cross occurs when a shorter-term moving average crosses above a longer-term moving average,
                typically the 50-day MA crossing above the 200-day MA, indicating a potential bullish trend.
                A Death Cross is the opposite, potentially signaling a bearish trend.
            </div>
        </div>
        
        <!-- Volume Candlesticks Chart (updated description) -->
        <div class="chart-container">
            <div class="chart-title">Volume Candlesticks Analysis</div>
            <img class="chart" src="$(chart_paths["volume"])" alt="Volume Candlesticks Chart">
            <div class="chart-description">
                Volume candlesticks display trading volume with color coding based on price direction - green for up days
                and red for down days. This visualization helps identify buying and selling pressure, with higher volume
                often confirming price movements. The chart also shows volume moving average for context.
            </div>
        </div>
    </div>
    
    <div class="container">
        <h2>Recent Signal Dates (Last 10)</h2>
        
        <h3>Buy Signals</h3>
        <div class="buy">
            $(get(analysis_data, "buy_dates", "No recent buy signals"))
        </div>
        
        <h3>Sell Signals</h3>
        <div class="sell">
            $(get(analysis_data, "sell_dates", "No recent sell signals"))
        </div>
    </div>
    
    <div class="footer">
        <p>Generated with Jaewoo's Financial Analysis Tools | $(Dates.format(Dates.today(), "yyyy-mm-dd"))</p>
    </div>
</body>
</html>